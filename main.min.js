function getid(){document.getElementById("screen-1").style.display="none",type=1,document.getElementById("idbutton").innerHTML="Copy",document.getElementById("screen-2").style.display="block",document.getElementById("playscreen").style.display="none",document.getElementById("post-done").style.display="none",document.getElementById("row").value=8,document.getElementById("column").value=15,document.getElementById("nop").value=2,document.getElementById("idfield").value="",document.getElementById("row").disabled=!1,document.getElementById("column").disabled=!1,document.getElementById("nop").disabled=!1,document.getElementById("idfield").disabled=!0,document.getElementById("done").disabled=!1,xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(id=this.responseText,document.getElementById("idfield").value=hexTo64(this.responseText))},xhttp.open("GET","Multiplayer/begin.php",!0),xhttp.send(),document.getElementById("idfield").disabled=!0}function enterid(){document.getElementById("screen-1").style.display="none",type=2,document.getElementById("idbutton").innerHTML="Connect",document.getElementById("screen-2").style.display="block",document.getElementById("post-done").style.display="none",document.getElementById("playscreen").style.display="none",document.getElementById("row").value="",document.getElementById("column").value="",document.getElementById("nop").value="",document.getElementById("idfield").value="",document.getElementById("row").disabled=!0,document.getElementById("column").disabled=!0,document.getElementById("nop").disabled=!0,document.getElementById("idfield").disabled=!1,document.getElementById("done").disabled=!0}function copybutton(){if(1==type){var e=document.querySelector(".js-copytextarea");document.getElementById("idfield").disabled=!1,e.select();try{document.execCommand("copy")}catch(e){window.alert("Not supported in your browser")}document.getElementById("idfield").disabled=!0}else""==(id=document.getElementById("idfield").value)?window.alert("No ID specified! Please enter ID in the given textbox."):(id=hexFrom64(id),xhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=this.responseText;if(""==e)window.alert("The configuration of the game has not been completed. Please try again.");else{var t=e.split("\n");ro=t[1],co=t[2],pl=t[0],document.getElementById("row").value=t[1],document.getElementById("column").value=t[2],document.getElementById("nop").value=t[0],document.getElementById("done").disabled=!1}}else 4==this.readyState&&404==this.status&&window.alert("Incorrect ID entered")},xhttp.open("GET","Multiplayer/"+id+"/game_data.grg",!0),xhttp.send())}function canc(){document.getElementById("screen-2").style.display="none",type=1,document.getElementById("screen-1").style.display="block"}function done(){nam=document.getElementById("name").value,pcolor=document.getElementById("col").style.backgroundColor,""==nam?window.alert("Name not specified"):1==type?(ro=document.getElementById("row").value,co=document.getElementById("column").value,pl=document.getElementById("nop").value,ro<5&&(ro=5),co<5&&(co=5),pl<2&&(pl=2),ro>17&&(ro=17),co>32&&(co=32),pl>6&&(pl=6),document.getElementById("idfield").disabled=!0,document.getElementById("row").disabled=!0,document.getElementById("column").disabled=!0,document.getElementById("nop").disabled=!0,document.getElementById("name").disabled=!0,document.getElementById("col").disabled=!0,document.getElementById("cancel").disabled=!0,document.getElementById("done").disabled=!0,document.getElementById("post-done").style.display="block",xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&(pa=1)},xhttp.open("GET","Multiplayer/setup.php?g_id="+id+"&nop="+pl+"&gridr="+ro+"&gridc="+co+"&pname="+nam+"&color="+pcolor,!0),xhttp.send()):(document.getElementById("idfield").disabled=!0,document.getElementById("row").disabled=!0,document.getElementById("column").disabled=!0,document.getElementById("nop").disabled=!0,document.getElementById("name").disabled=!0,document.getElementById("col").disabled=!0,document.getElementById("cancel").disabled=!0,document.getElementById("done").disabled=!0,document.getElementById("idbutton").disabled=!0,document.getElementById("post-done").style.display="block",xhttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=this.responseText;"ERR1"==e?(window.alert("Another player has same color."),document.getElementById("col").disabled=!1,document.getElementById("done").disabled=!1,document.getElementById("name").disabled=!1,document.getElementById("post-done").style.display="none"):"ERR2"==e?(window.alert("Another player has same name."),document.getElementById("col").disabled=!1,document.getElementById("done").disabled=!1,document.getElementById("name").disabled=!1,document.getElementById("post-done").style.display="none"):"ERR3"==e?(window.alert("The required number of players are already registered. You cannot join."),location.reload(!0)):""==e?(colors=new Array(pl),players=new Array(pl),pa=1):(window.alert("Another player has same name and color."),document.getElementById("col").disabled=!1,document.getElementById("done").disabled=!1,document.getElementById("name").disabled=!1,document.getElementById("post-done").style.display="none")}},xhttp.open("GET","Multiplayer/player_setup.php?g_id="+id+"&player_name="+nam+"&color="+pcolor,!0),xhttp.send())}function wait_players(){if(1==pa){var e;(e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){if(4==this.readyState&&200==this.status){for(var e=this.responseText.split("\n"),t=1,n=0,o=0,d=e.length;o<d;o++){var l=e[o];""!=l&&(t%2==0?(colors[n]=l,n+=1):(players[n]=l,l==nam&&(mycount=n+1)),t+=1)}if(n==pl){var a;a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),3!=mg&&(a.open("GET","Multiplayer/seen.php?g_id="+id+"&player="+mycount,!0),a.send(),pa=0,mg=1,makegrid()),clearInterval(wait)}}},e.open("GET","Multiplayer/"+id+"/players.grg",!0),e.send()}}function makegrid(){if(1==mg){mg=3,grid_data=new Array(ro);for(l=0;l<ro;l++){grid_data[l]=new Array(co);for(r=0;r<co;r++)grid_data[l][r]=0}currentplayer==mycount?(document.getElementById("status").innerHTML="<div>Your turn</div>",alertsound.volume(audiolvl),alertsound.play()):document.getElementById("status").innerHTML="<div>"+players[currentplayer-1]+"'s turn</div>";var e=colors[currentplayer-1].split(")")[0].split("(")[1].split(","),t=colourIsLight(e[0],e[1],e[2])?"black":"white";document.getElementById("status").style.backgroundColor=colors[currentplayer-1],document.getElementById("status").style.color=t,document.getElementById("screen-2").style.display="none",document.getElementById("playscreen").style.display="block",document.getElementById("status").style.display="block",document.getElementById("soundconf").style.display="block";for(var n=document.getElementById("playscreen"),o=(window.innerHeight-80)/ro,d=(document.body.clientWidth-10)/co,l=0;l<ro;l++){for(r=0;r<co;r++){n.innerHTML+="<input type='button' class='gridbuttons' disabled='true' onclick='chandle("+l.toString()+","+r.toString()+")' id='"+l.toString()+"-"+r.toString()+"'/>";var a=document.getElementById(l.toString()+"-"+r.toString());a.style.height=o+"px",a.style.width=d+"px"}n.innerHTML+="<br>"}for(var r=0;r<co;r++){var c=(l-1).toString()+"-"+r.toString();document.getElementById(c).disabled=!1,document.getElementById(c).style.backgroundColor="cadetblue"}start=1}}function chandle(e,t){if(mycount==currentplayer){var n=document.getElementById(e+"-"+t);1==(0==e?n:document.getElementById(e-1+"-"+t)).disabled||""==n.value?3!=mg||movedone||(movedone=!0,valx=e,valy=t,mg=1):alert("This box has already been clicked! Invalid move!")}else alert("Not your turn.")}function servercom(){if(1==start){start=0;var e,t,n;e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),movedone&&(e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=this.responseText;if("Invalid"==e&&movedone)alert("Previous move not yet seen by everyone!");else if("Sent"==e){mg=3;var t=valx,n=valy;if(0!=t)var o=document.getElementById(t+"-"+n),d=document.getElementById(t-1+"-"+n);else d=o=document.getElementById(t+"-"+n);d.disabled=!1,d.style.backgroundColor="cadetblue",o.value=mycount;var l=colors[mycount-1].split(")")[0].split("(")[1].split(","),a=colourIsLight(l[0],l[1],l[2])?"black":"white";o.style.backgroundColor=colors[mycount-1],o.style.color=a,grid_data[t][n]=mycount,rpc++;var r=0,c=0,u=0,s=0,i=0,m=t-3,y=t+3,g=n+3,p=n-3;m<0&&(c=-m,m=0),y>=ro&&(u=y-(ro-1),y=ro-1),g>=co&&(s=g-(co-1),g=co-1),p<0&&(i=-p,p=0);for(var b=grid_data[m][n],I=m;I<=y;I++)grid_data[I][n]==b&&0!=b?r++:(r=1,b=grid_data[I][n]),4==r&&(document.getElementById(I+"-"+n).style.backgroundColor="black",document.getElementById(I-1+"-"+n).style.backgroundColor="black",document.getElementById(I-2+"-"+n).style.backgroundColor="black",document.getElementById(I-3+"-"+n).style.backgroundColor="black",winner=mycount,setTimeout(winhandle,500));r=0,b=grid_data[y][p];var E=p+u-i;E<0&&(E=0),E>co-1&&(E=co-1);for(I=y;I>=m&&(grid_data[I][E]==b&&0!=b?r++:(r=1,b=grid_data[I][E]),4==r&&(document.getElementById(I+"-"+E).style.backgroundColor="black",document.getElementById(I+1+"-"+(E-1)).style.backgroundColor="black",document.getElementById(I+2+"-"+(E-2)).style.backgroundColor="black",document.getElementById(I+3+"-"+(E-3)).style.backgroundColor="black",winner=mycount,setTimeout(winhandle,500)),!(++E>g));I--);r=0,b=grid_data[t][p];for(I=p;I<=g;I++)grid_data[t][I]==b&&0!=b?r++:(r=1,b=grid_data[t][I]),4==r&&(document.getElementById(t+"-"+I).style.backgroundColor="black",document.getElementById(t+"-"+(I-1)).style.backgroundColor="black",document.getElementById(t+"-"+(I-2)).style.backgroundColor="black",document.getElementById(t+"-"+(I-3)).style.backgroundColor="black",winner=mycount,setTimeout(winhandle,500));r=0;var B=y,v=g,w=m,h=p;s>u?B=y-(s-u):u>s&&(v=g-(u-s)),i>c?w=m+(i-c):c>i&&(h=p+(c-i)),E=h,b=grid_data[w][E];for(I=w;I<=B&&(grid_data[I][E]==b&&0!=b?r++:(r=1,b=grid_data[I][E]),4==r&&(document.getElementById(I+"-"+E).style.backgroundColor="black",document.getElementById(I-1+"-"+(E-1)).style.backgroundColor="black",document.getElementById(I-2+"-"+(E-2)).style.backgroundColor="black",document.getElementById(I-3+"-"+(E-3)).style.backgroundColor="black",winner=mycount,setTimeout(winhandle,500)),!(++E>v));I++);rpc==co*ro&&(drawsound.volume(audiolvl),drawsound.play(),alert("Draw!")),mycount==pl?currentplayer=1:currentplayer++,currentplayer==mycount?(document.getElementById("status").innerHTML="<div>Your turn</div>",alertsound.volume(audiolvl),alertsound.play()):document.getElementById("status").innerHTML="<div>"+players[currentplayer-1]+"'s turn</div>",l=colors[currentplayer-1].split(")")[0].split("(")[1].split(","),a=colourIsLight(l[0],l[1],l[2])?"black":"white",document.getElementById("status").style.backgroundColor=colors[currentplayer-1],document.getElementById("status").style.color=a}movedone=!1}},1==mg&&(e.open("GET","Multiplayer/move.php?g_id="+id+"&by="+mycount+"&x="+valx+"&y="+valy,!0),e.send())),t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=this.responseText;if("UNCON"==e)alert("A player has disconnected. Game ended. Page will now refresh"),location.reload();else if(e!=latest_data&&""!=e){latest_data=e;var t=e.split(","),o=Number(t[0]),d=Number(t[1]),l=t[2];if(l!=mycount){if(currentplayer=l,n.open("GET","Multiplayer/seen.php?g_id="+id+"&player="+mycount,!0),n.send(),0!=o)var a=document.getElementById(o+"-"+d),r=document.getElementById(o-1+"-"+d);else r=a=document.getElementById(o+"-"+d);r.disabled=!1,r.style.backgroundColor="cadetblue",a.value=currentplayer;var c=colors[currentplayer-1].split(")")[0].split("(")[1].split(","),u=colourIsLight(c[0],c[1],c[2])?"black":"white";a.style.backgroundColor=colors[currentplayer-1],a.style.color=u,grid_data[o][d]=currentplayer,rpc++;var s=0,i=0,m=0,y=0,g=0,p=o-3,b=o+3,I=d+3,E=d-3;p<0&&(i=-p,p=0),b>=ro&&(m=b-(ro-1),b=ro-1),I>=co&&(y=I-(co-1),I=co-1),E<0&&(g=-E,E=0);for(var B=grid_data[p][d],v=p;v<=b;v++)grid_data[v][d]==B&&0!=B?s++:(s=1,B=grid_data[v][d]),4==s&&(document.getElementById(v+"-"+d).style.backgroundColor="black",document.getElementById(v-1+"-"+d).style.backgroundColor="black",document.getElementById(v-2+"-"+d).style.backgroundColor="black",document.getElementById(v-3+"-"+d).style.backgroundColor="black",winner=currentplayer,setTimeout(winhandle,500));s=0,B=grid_data[b][E];var w=E+m-g;w<0&&(w=0),w>co-1&&(w=co-1);for(v=b;v>=p&&(grid_data[v][w]==B&&0!=B?s++:(s=1,B=grid_data[v][w]),4==s&&(document.getElementById(v+"-"+w).style.backgroundColor="black",document.getElementById(v+1+"-"+(w-1)).style.backgroundColor="black",document.getElementById(v+2+"-"+(w-2)).style.backgroundColor="black",document.getElementById(v+3+"-"+(w-3)).style.backgroundColor="black",winner=currentplayer,setTimeout(winhandle,500)),!(++w>I));v--);s=0,B=grid_data[o][E];for(v=E;v<=I;v++)grid_data[o][v]==B&&0!=B?s++:(s=1,B=grid_data[o][v]),4==s&&(document.getElementById(o+"-"+v).style.backgroundColor="black",document.getElementById(o+"-"+(v-1)).style.backgroundColor="black",document.getElementById(o+"-"+(v-2)).style.backgroundColor="black",document.getElementById(o+"-"+(v-3)).style.backgroundColor="black",winner=currentplayer,setTimeout(winhandle,500));s=0;var h=b,k=I,f=p,_=E;y>m?h=b-(y-m):m>y&&(k=I-(m-y)),g>i?f=p+(g-i):i>g&&(_=E+(i-g)),w=_,B=grid_data[f][w];for(v=f;v<=h&&(grid_data[v][w]==B&&0!=B?s++:(s=1,B=grid_data[v][w]),4==s&&(document.getElementById(v+"-"+w).style.backgroundColor="black",document.getElementById(v-1+"-"+(w-1)).style.backgroundColor="black",document.getElementById(v-2+"-"+(w-2)).style.backgroundColor="black",document.getElementById(v-3+"-"+(w-3)).style.backgroundColor="black",winner=currentplayer,setTimeout(winhandle,500)),!(++w>k));v++);rpc==co*ro&&(drawsound.volume(audiolvl),drawsound.play(),alert("Draw!")),currentplayer==pl?currentplayer=1:currentplayer++,currentplayer==mycount?(document.getElementById("status").innerHTML="<div>Your turn</div>",alertsound.volume(audiolvl),alertsound.play()):document.getElementById("status").innerHTML="<div>"+players[currentplayer-1]+"'s turn</div>",c=colors[currentplayer-1].split(")")[0].split("(")[1].split(","),u=colourIsLight(c[0],c[1],c[2])?"black":"white",document.getElementById("status").style.backgroundColor=colors[currentplayer-1],document.getElementById("status").style.color=u}}}},t.open("GET","Multiplayer/"+id+"/latest.grg",!0),t.send(),start=1}}function winhandle(){var e=winner;mycount==e?(winsound.volume(audiolvl),winsound.play(),alert("You won! You will now be returned to main menu")):(endsound.volume(audiolvl),endsound.play(),alert("You lost. "+players[e-1]+" won. You will now be returned to main menu")),location.reload()}function resize(){if(1==start)for(var e=(window.innerHeight-80)/ro,t=(document.body.clientWidth-10)/co,n=0;n<ro;n++)for(var o=0;o<co;o++){var d=document.getElementById(n.toString()+"-"+o.toString());d.style.height=e+"px",d.style.width=t+"px"}}function setvol(e){audiolvl=e/10}var alertsound=new Howl({src:["Alert_2.mp3","Alert_2.ogg"]}),winsound=new Howl({src:["You_Win.mp3","You_Win.ogg"]}),endsound=new Howl({src:["Game_ends.mp3","Game_ends.ogg"]}),drawsound=new Howl({src:["Game_ends.mp3","Game_ends.ogg"]}),xhttp;xhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var type,id,ro,co,pl,nam,pcolor,colors=[],players=[],currentplayer=1,mycount,grid_data,rpc=0,latest_data,valx,valy,movedone=!1,wait,yeah,pa=0,start=0,mg=0,winner,audiolvl=1;window.onresize=resize,window.onload=function(){document.getElementById("screen-2").style.display="none",document.getElementById("playscreen").style.display="none",wait=setInterval(wait_players,500),yeah=setInterval(servercom,200)};var colourIsLight=function(e,t,n){return 1-(.299*e+.587*t+.114*n)/255<.5};